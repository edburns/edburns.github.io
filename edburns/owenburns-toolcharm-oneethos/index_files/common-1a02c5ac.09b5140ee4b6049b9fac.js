/*! For license information please see common-1a02c5ac.09b5140ee4b6049b9fac.js.LICENSE.txt */
"use strict";(self.webpackChunk_vzmi_finance_cosaic=self.webpackChunk_vzmi_finance_cosaic||[]).push([[1037],{8762:(e,r,a)=>{var t=a(4603);var i,s;i="undefined"!=typeof window?window:a.g,(s=void 0!==t.mE?t.mE:i.CIQ).ChartEngine.prototype.addSeries=function(e,r,a){var t=this.runPrepend("addSeries",arguments);if(t)return t;var i=e||null,n=e;e||(e=s.uniqueID()),r&&!0===r.panel&&(r.panel=e);var o={parameters:r?s.clone(r):{},yValueCache:[],display:i,id:e,loading:!r||!1!==r.loadData};o.parameters.yAxis=r&&r.yAxis,(r=o.parameters).symbol&&(n=r.symbol),r.isComparison&&(r.shareYAxis=!0),!r.yAxis||r.yAxis instanceof s.ChartEngine.YAxis||(r.yAxis=new s.ChartEngine.YAxis(r.yAxis)),s.ensureDefaults(r,{chartName:this.chart.name,symbolObject:{symbol:n},panel:this.chart.panel.name,fillGaps:!1,action:"add-series"}),"display"in r&&(o.display=r.display);var l=this.charts[r.chartName],p=r.symbolObject;n=r.symbol=p.symbol,r.isEvent&&(p.isEvent=!0),o.display||(o.display=n||r.field),o.endPoints={},r.gapDisplayStyle||!1===r.gapDisplayStyle||(r.gapDisplayStyle=r.gaps),r.isComparison&&void 0===r.gapDisplayStyle&&(r.gapDisplayStyle="transparent");var c=this.getSeries({symbolObject:p,chart:l,includeMaster:!0}),m=r.panel;if(this.panels[m])r.yAxis||r.shareYAxis||(r.yAxis=new s.ChartEngine.YAxis({name:e,position:"none"}));else{var h=r.yAxis||new s.ChartEngine.YAxis;h.name=e,this.createPanel(e,m,null,null,h),this.preferences.dragging&&this.preferences.dragging.series||(r.highlightable=!1)}l.series[e]=o;var d=this,u=this.currentlyImporting;function f(a,t){var i=r.renderer||"Lines",n=r.name||e;if(!r.yAxis||r.yAxis instanceof s.ChartEngine.YAxis||u||(r.yAxis.name=n),r.renderer||r.name||r.color||r.chartType){var o=a.getSeriesRenderer(n);if(!o){let e={name:n,overChart:!1!==r.overChart,useChartLegend:!0};if(r.chartType?o=s.Renderer.produce(r.chartType,s.extend({highlightable:r.highlightable,dependentOf:r.dependentOf,panel:r.panel,yAxis:r.yAxis,baseline:r.baseline},e)):(s.ensureDefaults(r,e),o=new s.Renderer[i]({params:r})),!o)return;a.setSeriesRenderer(o)}o.attachSeries(e,r),!1!==r.loadData&&o.ready(),a.layout.symbols=a.getSymbols({"include-parameters":!0,"exclude-studies":!0}),a.changeOccurred("layout")}}var y=r.responseHandler||function(e){return function(t){if(!t.error){var i=t.quotes,s=r.fillGaps;d.cleanupGaps||(s=!1),i=d.doCleanupGaps(i,d.chart,{cleanupGaps:s}),d.updateChartData(i,d.chart,{secondarySeries:n,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),o.loading=!1,o.moreAvailable=t.moreAvailable,o.upToDate=t.upToDate,f(d)}null===r.action||c.length||d.dispatch(u?"symbolImport":"symbolChange",{stx:d,symbol:e.symbol,symbolObject:e.symbolObject,action:r.action,id:o.id,parameters:r}),o.parameters.processResults&&o.parameters.processResults(d,t.error,o,t.quotes),a&&a.call(d,t.error,o)}};!r.isComparison||!l.forcePercentComparison||r.panel!=l.panel.name||r.yAxis&&r.yAxis!=l.yAxis||this.setChartScale("percent");var g=l.masterData;g||(g=l.masterData=this.masterData=[]);var v=g.length;if(r.data&&!r.data.useDefaultQuoteFeed)y({symbol:n,symbolObject:p,action:r.action})({quotes:r.data});else if(c.length)o.endPoints=c[0].endPoints,o.loading=c[0].loading,f(this),a&&setTimeout((function(){a.call(d,null,o)}),0);else if(this.quoteDriver&&!1!==r.loadData){var b=this.quoteDriver,C=b.makeParams(n,p,l);if(v&&(C.startDate=g[0].DT,C.endDate=this.isHistoricalMode()?g[g.length-1].DT:new Date),C.stx.isEquationChart(C.symbol))s.fetchEquationChart(C,y(C));else{var x=b.getQuoteFeed(C);x&&s.ChartEngine.Driver.fetchData(4,x.engine,C,y(C))}}else f(this),null===r.action||c.length||d.dispatch(u?"symbolImport":"symbolChange",{stx:d,symbol:n,symbolObject:p,action:r.action,id:o.id,parameters:r}),a&&a.call(this,null,o);return this.changeOccurred("layout"),this.runAppend("addSeries",arguments),o},s.ChartEngine.prototype.getSeries=function(e){var r=e.chart?e.chart:this.chart,a=r.series,t=e.symbolObject;t||(t={symbol:e.symbol});var i=[];for(var n in a){var o=a[n];s.symbolEqual(t,o.parameters.symbolObject)&&i.push(o)}return e.includeMaster&&s.symbolEqual(t,r.symbolObject)&&i.push({}),i},s.ChartEngine.prototype.modifySeries=function(e,r,a){var t,i,n;if(!this.runPrepend("modifySeries",arguments)&&r&&("string"==typeof e?(i=e,t=(n=r.chartName?this.charts[r.chartName]:this.chart).series[i]):(i=(t=e).id,n=this.charts[t.parameters.chartName]),t)){var o=t.parameters.panel,l=this.getRendererFromSeries(i);if(!l)return!1;if(s.extend(t.parameters,r,!0),r.chartType||r.renderer&&l.constructor!==s.Renderer[r.renderer])return l.removeSeries(i,!0),0===l.seriesParams.length&&Object.entries(this.chart.seriesRenderers).some((([e,r])=>{r===l&&delete this.chart.seriesRenderers[e]})),t.parameters.loadData=!0,t.parameters.chartType=r.chartType,t.parameters.type=r.type,void this.addSeries(i,t.parameters,(function(e,r){delete r.parameters.loadData}));l.modifyRenderer(r);var p,c=t.parameters;for(var m in n.seriesRenderers)for(var h=n.seriesRenderers[m],d=h.params,u=h.seriesParams,f=0;f<u.length;++f){var y=u[f],g=this.panels[y.panel],v=g&&g.yAxis.name;if(y.id===t.id){if(r.color&&(delete y.fill_color_down,delete y.fill_color_up,delete y.fill_color_even),r.border_color&&(delete y.border_color_down,delete y.border_color_up,delete y.border_color_even),!0===c.panel&&(c.panel=c.dependentOf||c.name),d.panel=c.panel,r.yAxis&&(r.yAxis instanceof s.ChartEngine.YAxis||(r.yAxis=new s.ChartEngine.YAxis(r.yAxis)),d.yAxis=r.yAxis),c.panel!=y.panel&&d.name==v)this.electNewPanelOwner(y.panel);else{var b=this.getYAxisByName(c.panel,d.name);b&&c.yAxis&&b.name!==c.yAxis.name&&(b.name=this.electNewYAxisOwner(b))}c.field||(c.field=null),h.attachSeries(i,Object.assign({},y,c)),c.field||(c.field=c.subField),delete c.subField,!c.isComparison||!n.forcePercentComparison||c.panel!=n.panel.name||t.parameters.yAxis&&c.yAxis.name!=n.yAxis.name||this.setChartScale("percent"),p=h;break}}if(this.draw(),o!==c.panel&&this.moveMarkers(o,c.panel,this.getMarkerArray("field",c.symbol)),s.getFn("Drawing.updateSource")(this,c.symbol||i,null,c.panel),this.runAppend("modifySeries",arguments),!0!==a){for(var C=p.getDependents(this),x=0;x<C.length;x++)if(C[x].seriesParams&&this.modifySeries(C[x].params.name,{panel:p.params.panel,yAxis:t.parameters.yAxis},!0),C[x].study){var A=C[x];A=s.Studies.replaceStudy(this,A.inputs.id,A.type,A.inputs,A.outputs,A.parameters,null,A.study)}var S=n.seriesRenderers[p.params.dependentOf];S&&(S.params.yAxis==t.parameters.yAxis&&S.params.panel==p.params.panel||this.modifySeries(p.params.dependentOf,{panel:p.params.panel,yAxis:t.parameters.yAxis},!0))}return this.changeOccurred("layout"),this.draw(),t}},s.ChartEngine.prototype.deleteSeries=function(e,r,a){if(this.runPrepend("deleteSeries",arguments))return;const t=(a=a||{}).action||"remove-series";let i;"object"==typeof e?(i=e.id,r=r||this.charts[e.parameters.chartName]):(i=e,r=r||this.chart);const s=r.series[i];if(!s)return;const{isEvent:n,loadData:o,symbolObject:l}=s.parameters;this.currentlyImporting||this.getMarkerArray("field",i).forEach((e=>this.removeFromHolder(e))),delete r.series[i],this.layout.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0});const p=this.getSeries({symbolObject:l,includeMaster:!0});n||!1===o||p.length||this.cleanMasterData(l,r);const c=this.panels[s.parameters.panel];c&&this.checkForEmptyPanel(c),this.createDataSet(),this.changeOccurred("layout"),p.length||n||this.dispatch(this.currentlyImporting?"symbolImport":"symbolChange",{stx:this,symbol:l.symbol,symbolObject:l,id:i,action:t}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)},s.ChartEngine.prototype.removeSeries=function(e,r){if(!this.runPrepend("removeSeries",arguments)){var a,t=!1;if("object"==typeof e?(a=e.id,r=r||this.charts[e.parameters.chartName]):(a=e,r=r||this.chart),r.series[a]){var i=r.series[a].parameters.takedownResults;i&&i(this,a)}for(var s in r.seriesRenderers)for(var n=r.seriesRenderers[s],o=this.panels[n.params.panel],l=o&&o.yAxis.name,p=n.seriesParams.length-1;p>=0;p--)if(n.seriesParams[p].id===a){if(n.removeSeries(a),n.seriesParams.length<1)if(this.removeSeriesRenderer(n),n.params.name==l)this.electNewPanelOwner(n.params.panel);else if(!this.checkForEmptyPanel(n.params.panel)){var c=this.getYAxisByName(o,n.params.name);c&&(c.name=c.studies[0]||c.renderers[1])}t=!0}t?this.changeOccurred("layout"):this.deleteSeries(a,r),this.resetDynamicYAxis(),this.draw(),this.resizeChart(),this.runAppend("removeSeries",arguments)}},s.Comparison=s.Comparison||function(){},s.Comparison.initialPrice=100,s.Comparison.getInitialPrice=function(e){if(e.initialComparisonPrice)return e.initialComparisonPrice;e.initialComparisonPrice=100;var r=s.Comparison.initialPrice;if("number"==typeof r&&(e.initialComparisonPrice=r),"string"==typeof r&&(e.series[r]||""===r)){var a="Close";e.defaultPlotField&&(e.highLowBars||(a=e.defaultPlotField));for(var t=e.dataSet.length-e.scroll-1;t<e.dataSet.length;t++){var i=e.dataSet[t];if(i){if(i[r]&&i[r][a]){e.initialComparisonPrice=i[r][a];break}if(""===r&&i[a]){e.initialComparisonPrice=i[a];break}}}}return e.initialComparisonPrice},s.Comparison.priceToPercent=function(e,r,a,t,i){let s=e.comparisonBaseline;return s&&i in s&&(s=s[i]),s&&"object"==typeof s&&(s=s[r.defaultPlotField||"Close"]),s=s||a,Math.round((a-s)/s*100*1e4)/1e4},s.Comparison.percentToPrice=function(e,r,a,t,i){let s=e.comparisonBaseline;return s&&i in s&&(s=s[i]),s&&"object"==typeof s&&(s=s[r.defaultPlotField||"Close"]),s=s||1,s*(1+a/100)},s.Comparison.priceToRelative=function(e,r,a,t,i){let n=e.comparisonBaseline,o=s.Comparison.getInitialPrice(r);return n&&i in n&&(n=n[i]),n&&"object"==typeof n&&(n=n[r.defaultPlotField||"Close"]),o*a/(n||a)},s.Comparison.relativeToPrice=function(e,r,a,t,i){let n=e.comparisonBaseline,o=s.Comparison.getInitialPrice(r);return n&&i in n&&(n=n[i]),n&&"object"==typeof n&&(n=n[r.defaultPlotField||"Close"]),(n||1)*a/o},s.Comparison.createComparisonSegmentInner=function(e,r){var a,t,i,n=[];for(a in r.series){var o=r.series[a].parameters;(!o.yAxis&&o.shareYAxis||o.yAxis===r.yAxis)&&n.push(o.symbol)}var l=["Close","Open","High","Low","iqPrevClose"],p=e.chart.highLowBars;r.defaultPlotField&&!p&&l.unshift(r.defaultPlotField);var c=l[0],m=e.layout.studies;for(var h in m){var d=m[h];if(t=e.panels[d.panel],i=d.getYAxis(e),t&&t.yAxis==i){for(a in d.outputMap)r.transformFunc&&i==r.panel.yAxis&&n.includes(d.inputs.Field)?l.push({comparison:d.inputs.Field,field:a}):l.push(a);for(var u=0;u<=2;u++)l.push(d.name+"_hist"+(u||""));d.referenceOutput&&l.push(d.referenceOutput+" "+d.name)}}for(var f in e.plugins){var y=e.plugins[f];if(y.transformOutputs)for(a in y.transformOutputs)l.push(a)}r.initialComparisonPrice=null,r.dataSegment=[];var g=null,v=r.dataSet.length-r.scroll-1;e.startComparisonsAtFirstVisibleBar&&(v+=1);for(var b=r.maxTicks+3,C=0;C<=b;C++){C==b&&(C=-1);var x=v+C;if(x<r.dataSet.length&&x>=0){var A,S,P=r.dataSet[x],D=P[c];if(!g){if(0===D||null===D){if(C<0)break;continue}g=s.clone(P)}for(P.transform||(P.transform={cache:{},DT:P.DT,Date:P.Date}),g&&g[c]||!D||(g=s.clone(P)),e.comparisonBaseline=g,A=0;A<l.length;A++)((S=P[a=l[A]])||0===S)&&(P.transform[a]=r.transformFunc(e,r,S));for(A=0;A<n.length;A++){a=n[A];var F=r.series[a];if(-1==C&&F&&F.parameters.isComparison)delete P.transform[a];else{var O=P[a];if(O)for(var w=0;w<l.length;w++){var E=l[w],T=O[E],j=P.transform[a]=P.transform[a]||{};if("object"==typeof E&&E.comparison==a&&(T=P[E=E.field],j=P.transform),T||0===T){var R=g[a]&&g[a][l[0]];R||0===R||(g[a]||(g[a]={}),g[a][E]=R=T),0===R||isNaN(R)||(j[E]=r.transformFunc(e,r,T,null,a))}}}}r.dataSegment.push(P)}else x<0&&r.dataSegment.push(null);if(C<0)break}},s.Comparison.priceFormat=function(e,r,a){if(null==a||isNaN(a))return"";var t=r.yAxis.priceTick,i=e.internationalizer;if(i)a=t>=5?i.percent.format(a/100):t>=.5?i.percent1.format(a/100):t>=.05?i.percent2.format(a/100):t>=.005?i.percent3.format(a/100):i.percent4.format(a/100);else{var s=a>0;a=t>=5?a.toFixed(0)+"%":t>=.5?a.toFixed(1)+"%":t>=.05?a.toFixed(2)+"%":t>=.005?a.toFixed(3)+"%":a.toFixed(4)+"%",s&&(a="+"+a)}return a},s.ChartEngine.prototype.setComparison=function(e,r,a){if(r||(r=this.chart),"string"==typeof r&&(r=this.charts[r]),(a||""===a)&&(s.Comparison.initialPrice=a),!0===e){if(r.isComparison)return;e="percent"}this.resetDynamicYAxis();var t=r.panel.yAxis,i=t.priceFormatter==s.Comparison.priceFormat;switch(e){case"relative":this.setTransform(r,s.Comparison.priceToRelative,s.Comparison.relativeToPrice),i&&(t.priceFormatter=t.originalPriceFormatter?t.originalPriceFormatter.func:null,t.originalPriceFormatter=null),t.whichSet="dataSegment",r.isComparison=!0;break;case"percent":this.setTransform(r,s.Comparison.priceToPercent,s.Comparison.percentToPrice),i||(t.originalPriceFormatter={func:t.priceFormatter},t.priceFormatter=s.Comparison.priceFormat),t.whichSet="dataSegment",r.isComparison=!0;break;default:this.unsetTransform(r),i&&(t.priceFormatter=t.originalPriceFormatter?t.originalPriceFormatter.func:null,t.originalPriceFormatter=null),t.whichSet="dataSet",r.isComparison=!1}},s.ChartEngine.prototype.setChartScale=function(e){var r=this.chart,a={percent:!0,relative:!0};e||(e="linear"),a[e]?this.setComparison(e,r,s.Comparison.initialPrice):a[this.layout.chartScale]&&this.setComparison(!1,r);var t=this.layout.chartScale!==e;this.layout.chartScale=e,r.canvas&&this.draw(),t&&this.changeOccurred("layout")}}}]);