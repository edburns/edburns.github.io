/*! For license information please see common-17a0a1b3.fb27f3e5230264dbb65c.js.LICENSE.txt */
"use strict";(self.webpackChunk_vzmi_finance_cosaic=self.webpackChunk_vzmi_finance_cosaic||[]).push([[6477],{7083:(e,t,a)=>{var r=a(4603);(e=>{var t=void 0!==r.mE?r.mE:e.CIQ;function a(){}t.ChartEngine||(t.ChartEngine=function(){}),a.fetchInitialData=function(e,t,a,r,i){},a.fetchUpdateData=function(e,t,a,r){},a.fetchPaginationData=function(e,t,a,r,i){},a.subscribe=function(e){},a.unsubscribe=function(e){},t.QuoteFeed=t.QuoteFeed||function(){},t.QuoteFeed.prototype.fetch=function(e,t){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},t.QuoteFeed.prototype.announceError=function(e,a){e.suppressErrors||a.suppressAlert||e.startDate||e.endDate||a.error&&t.alert("Error fetching quote:"+a.error)},t.QuoteFeed.prototype.multiFetch=function(e,t){return 0===e.length&&t([]),e[0].stx.driver.multiFetch(e,t)},t.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},t.inheritsFrom(t.QuoteFeed.Subscriptions,t.QuoteFeed),t.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(e){var t,a,r=e.getSymbols({"breakout-equations":!0}),i=this;r=r.filter((function(t){var a=e.quoteDriver.getQuoteFeed(t);return a&&a.engine==i}));for(var n=0;n<this.subscriptions.length;n++)this.subscriptions[n].match=!1;for(var o=0;o<r.length;o++){var s=(a=r[o]).interval;for("month"!=s&&"week"!=s||e.dontRoll||(s="day"),a.interval=s,a.period=1,a.match=!1,isNaN(a.interval)||(a.period=a.interval,a.interval=a.timeUnit,a.interval||(a.interval="minute")),delete a.periodicity,delete a.timeUnit,delete a.setSpan,n=0;n<this.subscriptions.length;n++){if((t=this.subscriptions[n]).symbol==a.symbol&&t.period==a.period&&t.interval==a.interval){a.match=!0,t.match=!0;break}t.symbol!=a.symbol?("period"!=a.reason&&(a.reason="symbol"),t.reason="symbol"):(a.reason="period",t.reason="period")}}this.subscriptions=this.subscriptions.filter((function(t){return t.match||(t.stx||(t.stx=e),i.unsubscribe(t)),t.match})),r.forEach((function(t){t.match||(t.stx||(t.stx=e),t.reason||(t.reason="initialize"),t.symbol!==e.chart.symbol&&(t.series=!0),i.subscribe(t),i.subscriptions.push(t))}))},t.QuoteFeed.Subscriptions.prototype.fetch=function(e,t){var a=this;this.fetchFromSource(e,(function(r){r.error||a.checkSubscriptions(e.stx),t(r)}))},t.QuoteFeed.Subscriptions.prototype.subscribe=function(e){console.log("subscribe",e)},t.QuoteFeed.Subscriptions.prototype.unsubscribe=function(e){console.log("unsubscribe",e)},t.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(e,t){console.log("Please provide implementation of fetchFromSource")},t.QuoteFeed.prototype.requiresImmediateRefresh=function(e){return!1},t.ChartEngine.prototype.attachQuoteFeed=function(e,a,r){a||(a={}),"function"!=typeof e.fetchInitialData&&"function"!=typeof e.fetchUpdateData&&"function"!=typeof e.fetchPaginationData||("function"!=typeof e.fetchPaginationData&&"function"!=typeof e.fetchUpdateData&&(a.noLoadMore=!0),e.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach((function(a){e[a]||!1===e[a]||(e[a]=t.QuoteFeed.prototype[a])})),"function"==typeof e.subscribe&&(e.checkSubscriptions=t.QuoteFeed.Subscriptions.prototype.checkSubscriptions,e.subscriptions=[])),a.maximumTicks||(a.maximumTicks=e.maxTicks?e.maxTicks:2e4),(!a.bufferSize||a.bufferSize<0)&&(a.bufferSize=0),a.bufferSize=Math.round(a.bufferSize),e.intervalTimer=null;var i=[];if(this.quoteDriver)if(!r&&this.quoteDriver.hasUnfilteredQuoteFeed)(i=this.quoteDriver.quoteFeeds.slice(0)).pop(),this.detachQuoteFeed();else{var n=this.quoteDriver.hasUnfilteredQuoteFeed&&this.quoteDriver.quoteFeeds.pop();this.quoteDriver.quoteFeeds.push({engine:e,behavior:a,filter:r}),n&&this.quoteDriver.quoteFeeds.push(n),this.quoteDriver.updateChartLoop(null,a,e)}if(!this.quoteDriver){for(var o of(this.quoteDriver=new t.ChartEngine.Driver(this,e,a,r),i))this.quoteDriver.quoteFeeds.push(o);if(!r){var s=this.quoteDriver.quoteFeeds.shift();this.quoteDriver.quoteFeeds.push(s),this.quoteDriver.quoteFeed=s.engine,this.quoteDriver.behavior=s.behavior}}r||(this.quoteDriver.hasUnfilteredQuoteFeed=!0)},t.ChartEngine.prototype.detachQuoteFeed=function(e){var t=this.quoteDriver;if(t){for(var a=t.quoteFeeds.length-1;a>=0;a--)e&&t.quoteFeeds[a].engine!=e||(t.quoteFeeds[a].filter||(t.hasUnfilteredQuoteFeed=!1),t.die(t.quoteFeeds[a]),t.quoteFeeds.splice(a,1));t.quoteFeeds.length?e==t.quoteFeed&&(t.quoteFeed=t.quoteFeeds[0].engine,t.behavior=t.quoteFeeds[0].behavior):t=this.quoteDriver=null}},t.ChartEngine.Driver=function(e,a,r,i){this.stx=e,r||(r={}),this.quoteFeeds=[{engine:a,behavior:r,filter:i}],this.id=t.uniqueID(!0),this.behavior=r,this.quoteFeed=a,this.loadingNewChart=!1,this.updatingChart=!1,i||(this.hasUnfilteredQuoteFeed=!0),this.updateChartLoop()},t.ChartEngine.Driver.prototype.die=function(e){for(var t=0;t<this.quoteFeeds.length;t++)if(!e||this.quoteFeeds[t]==e){var a=this.quoteFeeds[t];clearInterval(a.intervalTimer),a.intervalTimer=-1}},t.ChartEngine.Driver.prototype.getQuoteFeed=function(e){e.symbolObject||(e.symbolObject={symbol:e.symbol});for(var t=0;t<this.quoteFeeds.length;t++){var a=this.quoteFeeds[t];if(a.behavior.generator==e.symbolObject.generator&&(!a.filter||a.filter(e)))return a}return null},t.ChartEngine.Driver.prototype.multiFetch=function(e,a){0===e.length&&a([]);var r={counter:0,finished:e.length,results:[]};function i(e,t,a){return function(r){if(t.results.push({dataCallback:r,params:e}),t.counter++,t.counter>=t.finished){var i=t.results;t.results=[],a(i)}}}for(var n=0;n<e.length;n++){var o=e[n];if(o.stx.isEquationChart(o.symbol))t.fetchEquationChart(o,i(o,r,a));else{var s=this.getQuoteFeed(o);s&&t.ChartEngine.Driver.fetchData(t.QuoteFeed.SERIES,s.engine,o,i(o,r,a))}}},t.ChartEngine.Driver.prototype.updateSubscriptions=function(){for(var e=0;e<this.quoteFeeds.length;e++)this.quoteFeeds[e].checkSubscriptions&&this.quoteFeeds[e].checkSubscriptions(this.stx)},t.ChartEngine.Driver.prototype.loadDependents=function(e,a,r,i){var n,o=this;if(!i){var s=0,u=[],l=[],h=function(e){a&&++s>=o.quoteFeeds.length&&a(null)},c=function(t){++s<u.length||(l.length||h(),l.forEach((function(t){o.loadDependents(e,h,r,t.behavior)})))};return o.quoteFeeds.forEach((function(e){e.behavior.generator?l.push(e):u.push(e)})),void u.forEach((function(t){o.loadDependents(e,c,r,t.behavior)}))}var d,f,p=e.stx,m=e.chart,D=m.series,v=[],b={},g=r==t.QuoteFeed.UPDATE,y=r==t.QuoteFeed.PAGINATION,F=t.shallowClone(e);for(n in D){var T=(d=D[n]).parameters;if(!g){if(!e.future&&!1===d.moreAvailable)continue;if(e.future&&!0===d.upToDate)continue}if(!d.loading&&(!1!==T.loadData&&(!g&&!y||d.endPoints&&Object.keys(d.endPoints).length)&&(!T.data||T.data.useDefaultQuoteFeed)&&(f=T.symbolObject).symbol&&f.generator==i.generator)){F.symbolObject=f,F.symbol=f.symbol;var C=this.getQuoteFeed(F);if(i==(C&&C.behavior)){var S=!0;g||(d.loading=!0);for(var x=0;x<v.length;x++)t.symbolEqual(v[x],f)&&(S=!1);S&&(v.push(f),b[f.symbol]=d.endPoints)}}}for(var q=[],k=0;k<v.length;k++){f=v[k];var I=t.shallowClone(e.originalState);I.symbol=f.symbol,I.symbolObject=f,I.update||I.future?(I.endDate||(I.endDate=e.endDate),I.startDate=b[f.symbol].end):(I.startDate||(I.startDate=e.startDate),I.endDate=y&&!e.future?b[f.symbol].begin:e.endDate,I.ticks=e.ticks),q.push(I)}if(!q.length&&g){var E={appending:e.appending||e.originalState.update};return E.appending&&(E.appendToDate=e.startDate),p.createDataSet(null,null,E),e.nodraw||p.draw(),void(a&&a(null))}this.multiFetch(q,function(n){return function(s){for(var u=null,l=0;l<s.length;l++){var h=s[l],c=h.dataCallback.error;if(!c&&0!==c){var f=h.params.symbolObject,D=h.dataCallback,v=D.quotes,b=D.moreAvailable,g=D.upToDate,y=D.beginDate,F=D.endDate,T=[];p.getSeries&&(T=p.getSeries({symbolObject:f}));for(var C=!1,S=0;S<T.length;S++)d=T[S],n||(e.future?(d.upToDate=!0===g||(g||v.length<=(h.params.startDate?1:0)),p.isHistoricalModeSet&&v.length<2&&(d.mostRecentForwardAttempt=new Date)):d.moreAvailable=!1!==b&&(b||v.length>(h.params.endDate?1:0)),(!d.endPoints.begin||d.endPoints.begin>y)&&(d.endPoints.begin=y),(!d.endPoints.end||d.endPoints.end<F)&&(d.endPoints.end=F),d.loading=!1),C=d.parameters.fillGaps||C;v=o.cleanup(p,d,v,r,e,C),p.updateChartData(v,m,{secondarySeries:f.symbol,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),v&&v.length&&(!u||u>v[0].DT)&&(u=v[0].DT)}}s.length&&u&&(p.createDataSet(null,null,{appending:e.originalState.update||e.future,appendToDate:u}),e.nodraw||p.drawWithRange(),r==t.QuoteFeed.INITIAL&&o.resetRefreshInterval(i.refreshInterval,i)),a&&a(null)}}(g))},t.ChartEngine.Driver.prototype.cleanup=function(e,a,r,i,n,o){if(e.doCleanupDates(r,e.layout.interval),!n.missingBarsCreated&&r&&r.length&&e.cleanupGaps&&!1!==o){var s,u,l=n.chart;if(a?(l=a,u=a.parameters.symbol||a.id):u=l.defaultPlotField,i!=t.QuoteFeed.PAGINATION||n.loadMoreReplace){if(i==t.QuoteFeed.UPDATE&&l.endPoints.end&&l.endPoints.end<r[0].DT){var h=e.getFirstLastDataRecord(e.masterData,u,!0);a&&(h=h[u]),r.unshift(h),s="shift"}}else if(l.endPoints.begin&&l.endPoints.begin>r[r.length-1].DT){var c=e.getFirstLastDataRecord(e.masterData,u,!1);a&&(c=c[u]),r.push(c),s="pop"}r=e.doCleanupGaps(r,n.chart,{cleanupGaps:o,noCleanupDates:!0}),s&&r[s]()}return r},t.ChartEngine.Driver.prototype.updateChart=function(e){if(!this.updatingChart&&!this.loadingNewChart){var a=Object.keys(this.stx.charts).length,r=0,i=this.stx,n=i.layout.interval,o=i.layout.timeUnit;for(var s in i.charts){var u=i.charts[s];if(u.symbol){var l=this.makeParams(u.symbol,u.symbolObject,u),h=this.getQuoteFeed(l);if(u.masterData&&u.masterData.length&&(l.startDate=u.endPoints.end),l.update=!0,l.originalState=t.shallowClone(l),e&&e!=l.behavior)this.loadDependents(l,null,t.QuoteFeed.UPDATE,e);else{this.updatingChart=!0;var c=d(this,l,u.symbol,h);i.isEquationChart(l.symbol)?t.fetchEquationChart(l,c):h&&t.ChartEngine.Driver.fetchData(t.QuoteFeed.UPDATE,h.engine,l,c)}}}}function d(e,s,u,l){return s.behavior.prefetchAction&&s.behavior.prefetchAction("updateChart"),function(h){r++;var c=s.chart;if(u!=c.symbol||n!=i.layout.interval||o!=i.layout.timeUnit||i.isHistoricalMode())e.updatingChart=!1;else{if(l!==e.getQuoteFeed(s)||h.error)l&&l.engine.announceError(s.originalState,h);else{var d=h.quotes;d=e.cleanup(i,null,d,t.QuoteFeed.UPDATE,s),i.updateChartData(d,c,{noCreateDataSet:!0,noCleanupDates:!0}),c.attribution=h.attribution}r==a&&(e.updatingChart=!1),s.behavior.callback&&s.behavior.callback(s),e.loadDependents(s,null,t.QuoteFeed.UPDATE,s.behavior)}}}},t.ChartEngine.Driver.prototype.updateChartLoop=function(e,t,a){if(t||(t=this.behavior),a||(this.quoteFeeds.forEach((function(e){e.behavior===t&&(a=e)})),a||(a=this.quoteFeed)),-1!==a.intervalTimer){clearInterval(a.intervalTimer),a.intervalTimer=null;for(var r=function(e,t){return function(){t.noUpdate||e.updateChart(t)}},i=0;i<this.quoteFeeds.length;i++){var n=this.quoteFeeds[i].behavior;t!=n||n.noUpdate||(e||0===e||(e=n.refreshInterval),e&&(a.intervalTimer=setInterval(r(this,n),1e3*e)))}}},t.ChartEngine.Driver.prototype.resetRefreshInterval=function(e,t){(t||this.behavior).refreshInterval=e,this.updateChartLoop(null,t)},t.ChartEngine.Driver.prototype.pause=function(e){this.paused={symbol:e,interval:this.behavior.refreshInterval},this.resetRefreshInterval(0)},t.ChartEngine.Driver.prototype.resume=function(){let{interval:e,symbol:a}=this.paused;t.symbolEqual(a,this.stx.chart.symbol)||(this.resetRefreshInterval(e),this.paused=null)},t.ChartEngine.Driver.prototype.loadAll=function(e,t){var a=this,r=0;!function i(){return function(n){n?t(n):a.stx.currentlyImporting||!e.moreAvailable&&e.upToDate?t(null):++r>20?(console.warn("moreAvailable and upToDate not implemented correctly in quotefeed"),t()):(e.loadingMore=!1,a.checkLoadMore(e,!0,!0,i(),!0))}}()()},t.ChartEngine.Driver.prototype.checkLoadMore=function(e,a,r,i,n){var o=this.stx,s=this;if(e.loadingMore||this.loadingNewChart)return e.initialScroll=e.scroll,void(i&&i(null));o.isHistoricalMode()||(o.isHistoricalModeSet=!1);var u=this.makeParams(e.symbol,e.symbolObject,e);if(o.currentlyImporting)i&&i(null);else{var l,h,c=u.behavior,d=e.dataSet,f=1e3*(c.forwardPaginationRetryInterval||5),p=!1,m=!1;if(e.dataSet.length)for(var D in e.series){var v=e.series[D];v.loading||!1!==v.parameters.loadData&&(h=!v.mostRecentForwardAttempt||v.mostRecentForwardAttempt.getTime()+f<Date.now(),v.parameters.symbol!==e.symbol&&(!1!==v.moreAvailable&&I(v)&&(p=!0),h&&!v.upToDate&&E(v)&&(m=!0)))}h=!e.mostRecentForwardAttempt||e.mostRecentForwardAttempt.getTime()+f<Date.now();var b=(I(e)||a)&&!1!==e.moreAvailable,g=(E(e)||a)&&!e.upToDate&&h,y=b||p,F=(o.isHistoricalModeSet||!e.upToDate)&&!y&&(g||m),T=o.layout.interval,C=o.layout.timeUnit,S=!1,x=c.findHeadOfData||e.masterData&&e.masterData.length;if(!c.noLoadMore&&x&&(F||!o.maxDataSetSize||e.dataSet.length<o.maxDataSetSize)&&(y||F)){var q;if(e.initialScroll=e.scroll,e.loadingMore=!0,(u=this.makeParams(e.symbol,e.symbolObject,e)).pagination=!0,u.future=F,e.masterData&&e.masterData.length)F?u.startDate=e.endPoints.end:u.endDate=e.endPoints.begin,F&&!u.startDate?(q=o.getFirstLastDataRecord(e.masterData,"DT",!0))&&(u.startDate=q.DT):y&&!u.endDate&&(q=o.getFirstLastDataRecord(e.masterData,"DT"))&&(u.endDate=q.DT);else u.endDate=new Date;if(u.originalState=t.shallowClone(u),u.nodraw=n,!b&&(p||!g&&m))return this.loadingMore=!0,this.loadDependents(u,(function(t){e.loadingMore=!1,i&&i(t)}),t.QuoteFeed.PAGINATION),void(i&&i(null));(r||e.maximumForwardPagination||o.fetchMaximumBars[o.layout.aggregationType])&&(u.fetchMaximumBars=!0,!o.maxMasterDataSize||c.maximumTicks<o.maxMasterDataSize?u.ticks=c.maximumTicks:u.ticks=o.maxMasterDataSize);var k=function(e,a){return c.prefetchAction&&c.prefetchAction("checkLoadMore"),function(r){var o=e.stx,s=a.chart;if(a.symbol==s.symbol&&T==o.layout.interval&&C==o.layout.timeUnit)if(a.loadMore||(a.chart.loadingMore=!1),l!==e.getQuoteFeed(a)||r.error)e.quoteFeed.announceError(a.originalState,r),a.chart.loadingMore=!1,i&&i(r.error);else{r.quotes||(r.quotes=[]);var u=r.quotes,h=s.masterData;if((u=e.cleanup(o,null,u,t.QuoteFeed.PAGINATION,a)).length&&s.masterData&&s.masterData.length)if(a.future){var d=u[0];d.DT&&d.DT==s.masterData[s.masterData.length-1].DT&&h.pop()}else{var f=u[u.length-1];f.DT&&+f.DT==+s.masterData[0].DT&&u.pop()}a.future?(s.maximumForwardPagination=null,r.upToDate?s.upToDate=!0:!1===r.upToDate||u.length>1?s.upToDate=!1:(!u.length||1===u.length&&+a.startDate==+r.quotes[0].DT)&&(a.fetchMaximumBars?s.upToDate=!0:s.maximumForwardPagination=!0),o.isHistoricalModeSet&&u.length<2&&(s.mostRecentForwardAttempt=new Date)):r.moreAvailable||!1!==r.moreAvailable&&u.length?s.moreAvailable=!0:s.moreAvailable=!1,e.tickMultiplier=u.length?2:2*e.tickMultiplier;var p,m=u[0]?u[0].DT:a.startDate,D=u[0]?u[u.length-1].DT:a.endDate;r.beginDate&&(m=r.beginDate),(!s.endPoints.begin||s.endPoints.begin>m)&&(s.endPoints.begin=m),r.endDate&&(D=r.endDate),(!s.endPoints.end||s.endPoints.end<D)&&(s.endPoints.end=D),s.loadingMore=!1,a.loadMoreReplace?o.setMasterData(u,s,{noCleanupDates:!0}):a.future?o.updateChartData(u,s,{noCreateDataSet:!0,noCleanupDates:!0}):t.addMemberToMasterdata({stx:o,chart:s,data:u,fields:["*"],noCleanupDates:!0}),a.future&&(p={appending:!0,appendToDate:u[0]&&u[0].DT}),o.createDataSet(void 0,void 0,p),n||o.draw(),c.callback&&c.callback(a),e.loadDependents(a,i,t.QuoteFeed.PAGINATION)}}}(this,u);l=s.getQuoteFeed(u),o.isEquationChart(u.symbol)?t.fetchEquationChart(u,k):(F&&(u.appending=!0),l&&t.ChartEngine.Driver.fetchData(t.QuoteFeed.PAGINATION,l.engine,u,k)),S=!0}!S&&i&&i(null)}function I(t){return!s.paused&&(!t.endPoints.begin||d.length-e.scroll<c.bufferSize||d.length-e.scroll-o.tickFromDate(t.endPoints.begin,e)<c.bufferSize)}function E(t){return!s.paused&&(!t.endPoints.end||e.scroll-e.maxTicks+1<c.bufferSize||o.tickFromDate(t.endPoints.end,e,null,!0)-d.length+e.scroll-e.maxTicks+2<c.bufferSize)}},t.ChartEngine.Driver.prototype.extendHistoricalData=function({from:e},a=()=>{}){const{stx:r}=this,{chart:i,layout:n}=r,{masterData:o,dataSet:s}=i,{interval:u,timeUnit:l}=n,h=this.makeParams(i.symbol,i.symbolObject,i),c=this.getQuoteFeed(h);if(i.loadingMore||this.loadingNewChart||r.currentlyImporting||!o.length||!c||r.maxDataSetSize&&s.length>r.maxDataSetSize)return a(null);i.loadingMore=!0,h.originalState=Object.assign({},h),h.startDate=e,h.endDate=o[0].DT,t.ChartEngine.Driver.fetchData(t.QuoteFeed.PAGINATION,c.engine,h,function(o,s){return function({quotes:h,moreAvailable:c,error:d,beginDate:f}){if(s.symbol===i.symbol&&u===n.interval&&l===n.timeUnit){if(i.loadingMore=!1,d)return a(d);h=o.cleanup(r,null,h,t.QuoteFeed.PAGINATION,s),i.moreAvailable="boolean"==typeof c?c:!!h.length,i.endPoints.begin=f||e,t.addMemberToMasterdata({stx:r,chart:i,data:h,fields:["*"],noCleanupDates:!0}),r.createDataSet(),r.draw()}}}(this,h))},t.ChartEngine.Driver.prototype.barsToFetch=function(e){t.isValidNumber(this.tickMultiplier)||(this.tickMultiplier=2);var a=this.stx.layout.interval,r=e.stx.layout.periodicity;return"month"!=a&&"week"!=a||this.stx.dontRoll||(r*="week"==a?7:30),e.stx.chart.maxTicks*r*this.tickMultiplier},t.ChartEngine.Driver.determineStartDate=function(e,t,a){return this.determineStartOrEndDate(e,t,a,!0)},t.ChartEngine.Driver.determineStartOrEndDate=function(e,t,a,r){return r?e.startDate||t.previous(a):e.future?t.next(a):new Date},t.ChartEngine.Driver.prototype.makeParams=function(e,a,r){var i=this.stx,n=i.layout.interval,o=this.barsToFetch({stx:i});"month"!=n&&"week"!=n||i.dontRoll||(n="day");var s=this.getQuoteFeed({interval:n,symbol:e,symbolObject:a}),u=s&&s.behavior,l=t.shallowClone(u)||{};l.behavior=u;var h=!1,c=[];r.market&&r.market.getSessionNames&&(c=r.market.getSessionNames()),i.extendedHours?i.extendedHours.filter?h=!0:(h=i.layout.extended,c=c.filter((function(e){return e.enabled||i.layout.marketSessions[e.name]}))):c=c.filter((function(e){return e.enabled}));for(var d=0;d<c.length;d++)c[d]=c[d].name;return t.extend(l,{stx:i,symbol:e,symbolObject:a,chart:r,interval:n,extended:h,period:1,ticks:o,additionalSessions:c,quoteDriverID:this.id},!0),l.symbolObject||(l.symbolObject={symbol:e}),isNaN(l.interval)||(l.period=parseInt(l.interval,10),l.interval=i.layout.timeUnit,l.interval||(l.interval="minute")),l},t.ChartEngine.Driver.prototype.newChart=function(e,a){var r=this.stx,i=e.symbol,n=r.layout.interval,o=r.layout.timeUnit,s=e.chart;s.moreAvailable=null,s.upToDate=null,s.loadingMore=!1,s.attribution=null;var u=this.makeParams(i,e.symbolObject,s);t.extend(u,e,!0);var l=this.getQuoteFeed(u),h=u.behavior||{};(r.fetchMaximumBars[r.layout.aggregationType]||e.fetchMaximumBars)&&(!r.maxMasterDataSize||h.maximumTicks<r.maxMasterDataSize?u.ticks=h.maximumTicks:u.ticks=r.maxMasterDataSize,u.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,u.originalState=t.shallowClone(u);var c=function(s,u){return h.prefetchAction&&h.prefetchAction("newChart"),function(c){var d=u.chart,f=c.quotes,p=!1;if(i==d.symbol&&n==r.layout.interval&&o==r.layout.timeUnit){if(s.loadingNewChart=!1,l!==s.getQuoteFeed(u)||c.error)l.engine.announceError(u.originalState,c);else{f=s.cleanup(r,null,f,t.QuoteFeed.INITIAL,u),r.setMasterData(f,d,{noCleanupDates:!0}),d.endPoints={};var m=c.beginDate||(f[0]?f[0].DT:u.startDate);d.endPoints.begin=m;var D=c.endDate||(f[0]?f[f.length-1].DT:u.endDate);d.endPoints.end=D,f?(d.moreAvailable=!1!==c.moreAvailable,d.upToDate=c.hasOwnProperty("upToDate")?c.upToDate:!r.isHistoricalModeSet):(d.moreAvailable=!1,d.upToDate=!0),d.attribution=c.attribution,e.initializeChart&&r.initializeChart(),r.createDataSet(),p=!0}for(var v in d.series){var b=d.series[v];b.endPoints={},b.moreAvailable=null,b.upToDate=null,b.parameters.takedownResults&&b.parameters.takedownResults(r,v)}var g=d.masterData;if(g&&g.length){u.startDate=g[0].DT;const e=new Date,t=g[g.length-1].DT;u.endDate=t<e&&!r.isHistoricalMode()?e:t}h.callback&&h.callback(u),s.loadDependents(u,(function(){p&&!u.nodraw&&s.stx.home(),a&&a(c.error),s.stx.dispatch("newChart",{stx:s.stx,symbol:s.stx.chart.symbol,symbolObject:s.stx.chart.symbolObject,moreAvailable:s.stx.chart.moreAvailable,upToDate:s.stx.chart.upToDate,quoteDriver:s}),s.resetRefreshInterval(h.refreshInterval,h)}),t.QuoteFeed.INITIAL)}else a&&a("orphaned")}}(this,u);this.stx.isEquationChart(u.symbol)?t.fetchEquationChart(u,c):l&&t.ChartEngine.Driver.fetchData(t.QuoteFeed.INITIAL,l.engine,u,c)},t.QuoteFeed.INITIAL=1,t.QuoteFeed.UPDATE=2,t.QuoteFeed.PAGINATION=3,t.QuoteFeed.SERIES=4,t.ChartEngine.Driver.fetchData=function(e,a,r,i){if(!r.symbol)return i({quotes:[]});a.v2QuoteFeed?"function"!=typeof a.subscribe?t.ChartEngine.Driver.fetchDataInContext(e,a,r,i):t.ChartEngine.Driver.fetchDataInContext(e,a,r,function(e){e.error||this.checkSubscriptions(r.stx),i(e)}.bind(a)):(r.stx.convertToDataZone(r.startDate),r.stx.convertToDataZone(r.endDate),a.fetch(r,i))},t.ChartEngine.Driver.fetchDataInContext=function(e,a,r,i){var n,o,s,u,l=r.stx;if(l.chart.market.newIterator){e===t.QuoteFeed.SERIES&&(r.series=!0,e=t.QuoteFeed.INITIAL,r.endDate&&!r.startDate||r.future?e=t.QuoteFeed.PAGINATION:r.startDate&&!r.endDate&&(e=t.QuoteFeed.UPDATE));var h=Math.min(r.ticks,r.maximumTicks);a.maxTicks&&(h=Math.min(h,a.maxTicks));var c=r.symbolObject.masterSymbol||r.symbol;switch(e){case t.QuoteFeed.UPDATE:if(l.isHistoricalModeSet)return void(l.quoteDriver.updatingChart=!1);var d;r.startDate?d=r.startDate:(d=new Date).setHours(0,0,0,0),"function"==typeof a.fetchUpdateData&&a.fetchUpdateData(c,l.convertToDataZone(d),r,i);break;case t.QuoteFeed.INITIAL:n={begin:u=r.endDate||new Date,interval:r.interval,periodicity:"tick"==r.interval?l.chart.xAxis.futureTicksInterval:r.period,outZone:l.dataZone},o=l.chart.market.newIterator(n),s=t.ChartEngine.Driver.determineStartDate(r,o,h),r.endDate&&(u=r.endDate),"function"==typeof a.fetchInitialData&&a.fetchInitialData(c,s,l.convertToDataZone(u),r,i);break;case t.QuoteFeed.PAGINATION:n={begin:r.endDate||r.startDate,interval:r.interval,periodicity:"tick"==r.interval?l.chart.xAxis.futureTicksInterval:r.period,outZone:l.dataZone},o=l.chart.market.newIterator(n);var f=t.ChartEngine.Driver.determineStartOrEndDate(r,o,h,!r.future);if(s=r.startDate||f,u=r.endDate||f,r.startDate?r.stx.convertToDataZone(s):r.stx.convertToDataZone(u),"function"==typeof a.fetchPaginationData){if(l.maxMasterDataSize&&l.maxMasterDataSize<=l.masterData.length)return;a.fetchPaginationData(c,s,u,r,(function(e){u>=Date.now()&&(l.isHistoricalModeSet=!1),i&&i(e)}))}break;default:console.error("Illegal fetchData constant")}}else console.error("quoteFeed feature requires first activating market feature.")}})("undefined"!=typeof window?window:a.g)}}]);