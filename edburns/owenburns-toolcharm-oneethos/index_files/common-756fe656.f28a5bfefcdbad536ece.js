/*! For license information please see common-756fe656.f28a5bfefcdbad536ece.js.LICENSE.txt */
"use strict";(self.webpackChunk_vzmi_finance_cosaic=self.webpackChunk_vzmi_finance_cosaic||[]).push([[4189],{7816:(t,e,s)=>{s.d(e,{A:()=>g});var i=s(1662),n=s(4603),a=s(714),o=s(6215),r=s(9261),l=s(1108),c=s(8602);if(2346!=s.j)var h=s(7256);var u=s(4490);function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function m(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){p(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function p(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const y={interval:1,periodicity:1,chartType:"line",lineWidth:2,crosshair:!0,chartScale:"linear",timeUnit:"minute",color:a.lm.blue,padding:0},x=(0,l.P)("enabled");class g{constructor(t){var e;p(this,"_isOneDayRange",(()=>["1d","1d-sm","1d-qsp","1d-qsp-sm"].includes(this.config.chartRange))),(0,c.A)(n.mE);const s=n.mE.logVersion;n.mE.logVersion=function(){console.debug("Cosiac Version:","3.0.12"),s.call(n.mE)},this.config=Object.assign({},t,{layout:m(m(m({},y),t.layout),{},{timeUnit:(null===(e=t.layout)||void 0===e?void 0:e.timeUnit)||y.timeUnit})}),this.startRangeChange=null,this.endChartRangeChange=null,this.stx=null,this.positionCrosshairsAtPointerRef=null,this.callbacks={config:null,error:null,eventDataChange:null,eventMarkerHover:null,eventMarkerSelect:null,eventMarkerUnselect:null,instrument:null,seriesEdit:null,studyEdit:null},n.vn.timezone.loadingScheme=n.vn.timezone.loadingSchemes.MANUAL_LOAD,n.mE.timeZoneMap=o._,n.vn.timezone.loadZoneDataFromObject(o.H)}createChartInstance(){const{container:t,layout:e}=this.config;n.mE.ChartEngine.YAxis.prototype.width=1,this.stx=new n.mE.ChartEngine({container:t,layout:e,preferences:{currentPriceLine:!0},controls:n.mE.isMobile?{chartControls:null}:{},minimumCandleWidth:.5})}init(){const{decimalPlaces:t=2,featureFlags:e,showExtededHours:s=!1}=this.config;n.mE.ExtendedHours&&(new n.mE.ExtendedHours({stx:this.stx,filter:!0}),this.stx.extendedHours.prepare(s)),"none"===this.stx.chart.yAxis.position&&this.stx.setYAxisPosition(this.stx.chart.yAxis,"right"),this.customize(),!1!==this.config.showBeacon&&this.addBeaconImage(),n.mE.ChartEngine.YAxis.prototype.maxDecimalPlaces=t,n.mE.ChartEngine.YAxis.prototype.decimalPlaces=t,this.stx.cleanupGaps="gap",this.stx.setGapLines(!0),this.stx.yaxisLabelStyle="roundRect"}addBeaconImage(){const{container:t}=this.stx;let e=t.querySelector("#chart-beacon");e||(e=document.createElement("div"),e.id="chart-beacon",t.appendChild(e))}setChartHome(){this.stx.isHome()||this.stx.home()}updateBeaconStyle(){const t=this.stx.container.querySelector("#chart-beacon");if(t){let e;e=this._isOneDayRange()?(0,r.ql)(this.stx):(0,r.vz)(this.stx.chart.dataSegment);const s=!("mountain"===this.stx.layout.chartType)||!this.config.shouldUseUpdatedBeacon?"price-nutual":e<(0,r.z9)(this.stx.chart.dataSegment).Close?"price-up":"price-down",i=this.stx.chart.market.isOpen()?"pulse":"";t.className=`${s} ${i}`}}cleanup(){this.positionCrosshairsAtPointerRef&&(this.stx.removeInjection(this.positionCrosshairsAtPointerRef),this.positionCrosshairsAtPointerRef=null)}customize(){const t=this,{height:e}=t.stx.container.querySelector(".stx-subholder").getBoundingClientRect();this.positionCrosshairsAtPointerRef=this.stx.append("positionCrosshairsAtPointer",(function(){"Close"===this.preferences.horizontalCrosshairField||(this.controls.crossY.style.top=`${this.cy}px`)})),n.mE.ChartEngine.prototype.padOutPrice=function(t,e){if(0!==t&&(!t||"number"!=typeof t))return"";e||0===e||(e=t);const s=`${e}`;let i=0;s.indexOf(".")>-1&&(i=s.substring(s.indexOf(".")).length-1),i=e>=1e3?Math.max(i,0):e<2?Math.max(i,4):Math.max(i,2),i=Math.min(i,this.chart.yAxis.maxDecimalPlaces);const{internationalizer:n}=this;if(n){const e=n.priceFormatters.length;i>=e&&(i=e-1),t=n.priceFormatters[i].format(t)}else t=t.toFixed(i);return t},n.mE.alert=function(t){console.warn("> FinChart alert:",t)},n.mE.ChartEngine.prototype.append("draw",(function(){var s;const i=t.stx.container.querySelector("#chart-beacon");if(!i)return;const n=["mountain","line","step","baseline_delta","colored_mountain","colored_line","colored_step","step_mountain","vertex_line","vertex_step","vertex_mountain","vertex_baseline_delta","mountain_baseline_delta"].includes(this.layout.chartType);if(i&&n&&null!==(s=this.chart.dataSet)&&void 0!==s&&s.length&&!this.chart.standaloneBars){const{panel:s}=this.chart,n=(0,r.z9)(this.getDataSegment());if(!n)return;const a=n.Close;let o=this.pixelFromTick(n.tick,this.chart);this.chart.lastTickOffset&&(o+=this.chart.lastTickOffset);const l=this.pixelFromPrice(a,s);i.style.display="block",t.updateBeaconStyle();const c=Math.max(0,Math.min(l-3,e));i.style.left=o-2+"px",i.style.top=`${c}px`}else i.style.display="none"})),n.mE.isMobile&&this.enableCrosshairViaLongTouch()}async loadChart(t,e={},s=Function.prototype){var a,r,l;this.quoteMeta=await g.fetchQuoteType({symbol:t});const{exchangeTimezoneName:c,market:d}=this.quoteMeta;if(c&&d){const t=o._[c]||c;if(this.stx.displayZone!==t&&this.stx.setTimeZone(null,t),this.stx.chart.market.market_def.name!==d){const t=await(0,i.QP)(d),e=t.market_tz;t.market_tz=o._[e]||e,this.stx.setMarketFactory((e=>"object"!=typeof e?null:t))}}const{layout:{padding:p},container:y,quoteFeed:{lang:x}}=this.config,f=m(m({},e),{},{span:m(m({},e.span),{},{padding:p})});(0,u.x)(x,y,n.mE,this.stx);const b=null===(a=this.context)||void 0===a?void 0:a.loader;null==b||b.show(),null===(r=this.events)||void 0===r||r.clearSelectedTechnicalEvent(),this.stx.loadChart(m({symbol:t},null!==(l=this.quoteMeta)&&void 0!==l&&l.market?{market:this.quoteMeta.market,quoteType:this.quoteMeta.quoteType}:{}),f,(e=>{if(e||this.isEmptyChart())return console.error("> finance-cosaic: error on chart load",e),null==s||s(e),void this.doCallback("error",{status:500,message:`Error during loadChart:${t}`});null==b||b.hide(),setTimeout((()=>{var e,i,n;(0,h.cS)(this,t),null===(e=this.events)||void 0===e||e.showEvents(),this.setChartHome(),null===(i=this.config.comparison)||void 0===i||i.forEach((t=>{t&&this.addSeries(t,{isComparison:!0})})),null==s||s(null,this.stx),null===(n=this.eventsQuote)||void 0===n||n.showEvents(this.config.chartRange,this.quoteMeta.selerityIsGaap)}),0)}))}addSeries(t,e={},s=Function.prototype){if(t===this.stx.chart.symbol||this.stx.chart.series[t])return;const{series:i}=this.stx.chart;if(!e.color){const t=Object.values(i).map((t=>t.parameters.color)),s=x.filter((e=>!t.includes(e)));0===s.length?e.color=x[Object.keys(i).length%x.length]:[e.color]=s}e.gapDisplayStyle=!0,this.stx.addSeries(t,e,s)}removeSeries(t,e){this.stx.removeSeries(t,e)}setPredefinedSpan(t,e=Function.prototype){var s;this.startRangeChange=Date.now();const i=null===(s=this.context)||void 0===s?void 0:s.loader;null==i||i.show(),this.stx.setSpan(m(m({},a.G7[t]),{},{padding:this.config.layout.padding}),((...s)=>{var n;this.endChartRangeChange=Date.now(),this.setChartHome(),this.events&&null!==(n=this.config)&&void 0!==n&&null!==(n=n.events)&&void 0!==n&&n.enabled&&"NONE"!==this.stx.chart.symbolObject&&this.events.showEvents(),this.config.chartRange=t,e(this.stx,...s),null==i||i.hide()}))}setInterval(t,e=Function.prototype){this.stx.setPeriodicity(a.ag[t],(()=>{this.setChartHome(),e(),this.config.interval=t}))}addMultiSeries(t,e={},s=Function.prototype){(Array.isArray(t)?t:[t]).forEach((t=>{this.stx.addSeries(t,e,s)}))}removeAllSeries(){Object.keys(this.stx.chart.series).forEach((t=>this.removeSeries(t)))}setTheme(t="light"){const e={dark:{remove:["ciq-day"],add:"ciq-night"},light:{remove:["ciq-night"],add:"ciq-day"}}[t]||null;if(e){const t=document.querySelector("cq-context");t&&!t.classList.contains(e.add)&&(t.classList.add(e.add),e.remove.forEach((e=>{t.classList.remove(e)})),this.stx.setThemeSettings())}}setStickyCrosshair(t){this.stx.preferences.horizontalCrosshairField=t?"Close":null,this.stx.dispatch("preferences",{stx:this.stx,symbol:this.stx.chart.symbol,symbolObject:this.stx.chart.symbolObject,layout:this.stx.layout,drawings:this.stx.drawingObjects})}setExtendedHours(t,e){this.stx.layout.extended=t,!this.stx.layout.extended||this.stx.chart.market.market_def&&this.stx.chart.market.sessions.length?(this.stx.extendedHours.prepare(t,null),this.stx.changeOccurred("layout"),this.stx.createDataSet(),this.stx.drawWithRange(!0),null==e||e(!0)):null==e||e(!1)}dispatchLayoutChangeEvent(){this.stx.dispatch("layout",{stx:this.stx,symbol:this.stx.chart.symbol,symbolObject:this.stx.chart.symbolObject,layout:this.stx.layout,preferences:this.stx.preferences,drawings:this.stx.drawingObjects})}addEventListener(t,e){void 0!==this.callbacks[t]&&"function"==typeof e&&(this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e))}removeEventListener(t,e){if(void 0===this.callbacks[t]||"function"!=typeof e||!this.callbacks[t]||0===this.callbacks[t].length)return;const s=this.callbacks[t].indexOf(e);-1!==s&&(this.callbacks[t].splice(s,1),0===this.callbacks[t].length&&(this.callbacks[t]=null))}doCallback(t,...e){const{length:s=0}=this.callbacks[t]||{};if(s>0)for(let i=0;i<s;i++)this.callbacks[t][i](...e)}isEmptyChart(){const t=this.stx.getDataSegment();return!t||0===t.length}static async fetchQuoteType({symbol:t,lang:e="en-US",region:s="US"},n=3){try{const{quoteType:n}=await(0,i.In)(`${(0,i.xv)()}${i.Y$.QUOTE_TYPE_PATH}?${(0,i.Bp)({symbol:t,lang:e,region:s})}`),[a]=n.result;return a||{}}catch(a){if(("AbortError"===a.name||"Request Timeout"===a.message)&&n>0)return this.fetchQuoteType({symbol:t,lang:e,region:s},n-1);throw a}}enableCrosshairViaLongTouch(){const{layout:t}=this.stx;let e=null,s=null;const i=e=>{t.crosshair=!0,this.stx.doDisplayCrosshairs(),this.stx.touchstart(e)},n=()=>{t.crosshair=!1,this.stx.undisplayCrosshairs()};this.stx.addEventListener("move",(function(){null!==e&&(clearTimeout(e),e=null)})),this.stx.prepend("touchstart",(function(n){t.crosshair?null!==s&&(clearTimeout(s),s=null):1===n.touches.length&&(e=setTimeout(i,300,n))})),this.stx.append("touchend",(function(){t.crosshair&&(s=setTimeout(n,1800)),null!==e&&(clearTimeout(e),e=null)}))}}}}]);